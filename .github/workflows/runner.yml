name: GitHub Proxy Runner
on:
  schedule:
    +6- cron: '0 */4 * * *' # اجرای خودکار هر ۴ ساعت برای پایداری [۵۸۲]
  workflow_dispatch:      # امکان اجرای دستی [۵۸۳]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy and Keep Alive
        run: |
          # ۱. دانلود اسکریپت به صورت محلی برای جلوگیری از خطای شل [۷۲۱]
          curl -Ls https://raw.githubusercontent.com/yonggekkk/argosbx/main/argosbx.sh -o argosbx.sh
          chmod +x argosbx.sh
          
          # ۲. اجرای اسکریپت با متغیرهای اصلاح شده
          # نکته: تعریف vwpt برای فعال شدن بخش آرگو الزامی است [۶۶۰]
          sudo -E ./argosbx.sh
          
          # ۳. زنده نگه داشتن رانر تا سقف ۶ ساعت [۵۸۲]
          # بدون این خط، رانر بلافاصله پس از نصب خاموش می‌شود
          sleep infinity 
        env:
          vlpt: 2053                # پورت Reality (اتصال مستقیم) [۶۷۰]
          vwpt: 8080                # حیاتی: پورت WebSocket برای فعال‌سازی آرگو [۶۶۰، ۶۶۹]
          argo: vwpt                # دستور به اسکریپت برای ایجاد تونل آرگو [۶۸۳]
          uuid: e69cc705-8d07-4131-8ec7-3b6e797207ff
          cf_token: ${{ secrets.CF_API_TOKEN }}
          cf_zone: ${{ secrets.CF_ZONE_ID }}
